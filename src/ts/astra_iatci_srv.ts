include(ts/macro.ts)
include(ts/adm_macro.ts)

# meta: suite iatci

$(defmacro ETS_COS_EXCHANGE
    tickno
    cpnno
    status
{

>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ $(tickno) $(cpnno) $(status))
<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref) $(tickno) $(cpnno) $(status))

}) #end-of-macro

#########################################################################################
# №1

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PSI++FQTV:UT:1017820380"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+FQTV:UT:1017820380"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №2

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN++S71027"
PRD+Y"
PSD++1A"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"


# пошёл запрос в СЭБ на смену статуса из астры
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ 2982401841689 1 CK)


# эмуляция таймаута ответа СЭБ
$(pg_sql {update EDISESSION_TIMEOUTS set time_out = current_timestamp - interval '1 hour'})
$(run_daemon edi_timeout)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"



# ещё запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000670001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00067"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN++S71027"
PRD+Y"
PSD++1A"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000670001"


# пошёл запрос в СЭБ на смену статуса из астры
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref) 2982401841689 1 CK)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000670001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00067"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000670001"



# отмена регистрации в Астру
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+M++IVAN++S71027"
UNT+5+1"
UNZ+1+ASTRA000680001"


# пошли в СЭБ откатывать статус купона
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ 2982401841689 1 I)
<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref) 2982401841689 1 I)


# ответ на отмену из Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"


# ещё одна отмена регистрации в Астру
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000690001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00069"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+M++IVAN++S71027"
UNT+5+1"
UNZ+1+ASTRA000690001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000690001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00069"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:194:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000690001"


# ещё запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000670001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00067"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN++S71027"
PRD+Y"
PSD++1A"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000670001"


# пошёл запрос в СЭБ на смену статуса из астры
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ 2982401841689 1 CK)
<<
$(TKCRES_ET_COS_ERR UTET UTDC $(last_edifact_ref) 396 "НЕВЕРНЫЙ СТАТУС БИЛЕТА/КУПОНА")


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000670001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00067"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000670001"


%%
#########################################################################################
# №3

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# PLF до регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000700001+++O"
UNH+1+DCQPLF:03:1:IA+ASTRA00070"
LOR+UT:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
SPD+REPIN:IVAN::1"
UNT+5+1"
UNZ+1+ASTRA000700001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000700001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00070"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+P+X"
ERD+1:84:FUNCTION NOT SUPPORTED"
UNT+5+1"
UNZ+1+ASTRA000700001"


# регистрация
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


# PLF после регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000710001+++O"
UNH+1+DCQPLF:03:1:IA+ASTRA00071"
LOR+UT:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
SPD+REPIN:IVAN::1"
UNT+5+1"
UNZ+1+ASTRA000710001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000710001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00071"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+P+X"
ERD+1:84:FUNCTION NOT SUPPORTED"
UNT+5+1"
UNZ+1+ASTRA000710001"

# >>
#UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000710001+++T"
#UNH+1+DCRCKA:03:1:IA+ASTRA00071"
#FDR+UT+103+$(yymmdd)1015+DME+LED"
#RAD+P+O"
#PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
#PRD+Y"
#PFD...
#PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
#PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
#UNT+9+1"
#UNZ+1+ASTRA000710001"


%%
#########################################################################################
# №4

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"


$(ETS_COS_EXCHANGE 2982401841689 1 CK)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
UPD+A+DOBRENIC++BERI"
UNT+7+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+X"
ERD+1:84:FUNCTION NOT SUPPORTED"
UNT+5+1"
UNZ+1+ASTRA000660001"


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
USI++A:OTHS::::::OTHS FREE TEXT"
UAP+R+:::760501:::RUS++P:99999999999:USA:::491231:M::::::REPIN:IVAN:ABRAMOVICH"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


# ещё запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
USI++C:OTHS::::::OTHS FREE TEXT+A:FQTV:UT:1230012345+A:FQTV:UT:1230012345"  # специально дублируется FQTV
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №5

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQSMF:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRSMF:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+S+O"
CBD+Y...
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №6

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
USD++4А"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"

%%
#########################################################################################
# №7

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"



<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
UNT+5+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+B+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"



%%
#########################################################################################
# №8 левый запрос

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UU+103+$(yymmdd)+LAL+LOL++OO+1027+$(yymmdd)0530+$(yymmdd)0940+AAA+BBB"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UU+103+$(yymmdd)+LAL+LOL++T"
RAD+I+X"
ERD+1:5:INVALID FLIGHT/DATE"
UNT+5+1"
UNZ+1+ASTRA000660001"

# считаем, что DCRCKA не дошёл до адресата, и эмулируем посылку им IFM
<<
IFMDCS2
.IFMDCS1
IFM
OO1027/$(ddmon +0 en) AAA PART1
-UU103/$(ddmon +0 en) LALLOL
DEL
1REPIN/IVAN
ENDIFM


%%
#########################################################################################
# №9 host to host

$(init_term 201509-0173355)

$(init_dcs У6 U6 UT)


# запрос к Астре
<< h2h=V.\VHLG.WA/E11ADCS1/I11HDCS2/P015ZK3\VGYA\$()
UNB+SIRE:1+U6+UT+161019:0436+1"
UNH+1+DCQSMF:03:1:IA+GUZ2TQPGKY0025"
LOR+U6:LCG"
FDQ+U6+537+$(yymmdd)+SAW+MAD"
SRP+Y"
UNT+5+1"
UNZ+1+1"

>>
UNB+SIRE:1+UT+U6+xxxxxx:xxxx+1"
UNH+1+DCRSMF:03:1:IA+GUZ2TQPGKY0025"
FDR+U6+537+$(yymmdd)+SAW+MAD++T"
RAD+S+X"
ERD+1:5:INVALID FLIGHT/DATE"
UNT+5+1"
UNZ+1+1"


%%
#########################################################################################
# №10

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"


$(ETS_COS_EXCHANGE 2982401841689 1 CK)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


# но ответ потерялся и нам прислали IFM DEL
<<
IFMDCS2
.IFMDCS1
IFM
S71027/$(ddmon +0 en) AER PART1
-UT103/$(ddmon +0 en) DMELED
DEL
1REPIN/IVAN
ENDIFM

$(ETS_COS_EXCHANGE 2982401841689 1 I)


%%
#########################################################################################
# №11

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                                           REPIN IVAN 2982401841689 1
                                           PETROV PETR 2982401841612 1)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
UNT+12+1"
UNZ+1+ASTRA000660001"

# идём в СЭБ
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 1) ЮТ 2982401841612 1 CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 0) ЮТ 2982401841689 1 CK)

# один ответ пришёл, другой затаймаутился
<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref) 2982401841689 1 CK)


$(pg_sql {update EDISESSION_TIMEOUTS set time_out = current_timestamp - interval '1 hour'})
$(run_daemon edi_timeout)

# окат успешной смены статуса
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref) ЮТ 2982401841689 1 I)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №12

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                                           REPIN IVAN 2982401841689 1
                                           REPIN PETR 2982401841612 1)


$(deny_ets_interactive ЮТ 103 ДМД)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
PSI++TKNE"
UNT+9+1"
UNZ+1+ASTRA000660001"


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/REPIN/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/REPIN/PETR/M"
PAP+A:REPIN:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::REPIN:PETR"
UNT+10+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №13

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   REPIN IVAN 2982401841612 1)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:1:PASSENGER SURNAME NOT FOUND"
UNT+5+1"
UNZ+1+ASTRA000660001"


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:6:TOO MANY PASSENGERS WITH SAME SURNAME"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №14

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   PETROV PETR 2982401841612 1)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+12+1"
UNZ+1+ASTRA000660001"


# запросы в СЭБ
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 1) ЮТ 2982401841612 1 CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 0) ЮТ 2982401841689 1 CK)


# не получили ни одного ответа от СЭБ

$(pg_sql {update EDISESSION_TIMEOUTS set time_out = current_timestamp - interval '1 hour'})
$(run_daemon edi_timeout)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №15

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                                           REPIN IVAN 2982401841689 1
                                           PETROV PETR 2982401841612 1)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+12+1"
UNZ+1+ASTRA000660001"


$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

# запросы в СЭБ
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841612 1 CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841689 1 CK)


<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841612 1 CK)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
PPD+PETROV+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/PETROV/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/PETROV/PETR/M"
PAP+A:PETROV:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::PETROV:PETR"
UNT+15+1"
UNZ+1+ASTRA000660001"


# ешё один запрос к Астре на регистрацию
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+12+1"
UNZ+1+ASTRA000660001"


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:17:PASSENGER SURNAME ALREADY CHECKED IN"
UNT+5+1"
UNZ+1+ASTRA000660001"



# отмена регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000680001"


# пошли откатывать статусы
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 1) ЮТ 2982401841612 1 I)
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 0) ЮТ 2982401841689 1 I)


# не получили ни одного ответа от СЭБ

$(pg_sql {update EDISESSION_TIMEOUTS set time_out = current_timestamp - interval '1 hour'})
$(run_daemon edi_timeout)

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000680001"


# отмена регистрации с "левым"(незарегистрированным) пассажиром
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
PPD+BOKOV+A:N++ANTON"
UNT+7+1"
UNZ+1+ASTRA000680001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:194:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000680001"



# отмена регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000680001"


# пошли откатывать статусы

$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841612 1 I)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841689 1 I)


<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841689 1 I)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841612 1 I)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"



# и ещё раз отмена регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000680001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:194:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000680001"


%%
#########################################################################################
# №16

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   PETROV PETR 2982401841612 1)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре на регистрацию одного пакса
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


# запрос к Астре на регистрацию второго пакса
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+PETROV+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/PETROV/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/PETROV/PETR/M"
PAP+A:PETROV:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::PETROV:PETR"
UNT+10+1"
UNZ+1+ASTRA000660001"


# отмена регистрации обоих
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000680001"

# так нельзя
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000680001"


# печать обоих
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000660001"

# так тоже нельзя
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+B+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №17

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   PETROV PETR 2982401841612 1)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
UNT+12+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
PPD+PETROV+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/PETROV/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/PETROV/PETR/M"
PAP+A:PETROV:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::PETROV:PETR"
UNT+15+1"
UNZ+1+ASTRA000660001"


# печать обоих
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+B+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
PPD+PETROV+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/PETROV/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/PETROV/PETR/M"
PAP+A:PETROV:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::PETROV:PETR"
UNT+15+1"
UNZ+1+ASTRA000660001"


# отмена обоих
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК"
PPD+REPIN+A:N++IVAN"
PPD+PETROV+A:N++PETR"
UNT+6+1"
UNZ+1+ASTRA000680001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"


%%
#########################################################################################
# №18

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   ONE CHILD 2982401841689 1
                   PETROV PETR 2982401841612 1)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+ONE+C:N++CHILD++0013949607"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+0"
PSI++TKNE::29824018416891+WCHR::::1::911"
CRI+PP:12345678"
PAP+A:ONE:CHILD H:080101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::ONE:CHILD H"
UNT+11+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+ONE+C:N+xxxxxxxxxx+CHILD"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/CHILD+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/CHILD/M+WCHR::::::911"
PAP+A:ONE:CHILD:080101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::ONE:CHILD H"
UNT+10+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №19

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_1INFT_1SEG ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   ONE ADULT 2982401841612 1
                   ONE INFANT 2982401841689 1)


# регистрация пакса с младенцем
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+ONE+M:Y++ADULT+ONE:INFANT+0013949613:0013949614"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+0"
PSI++TKNE::29824018416121+TKNE::INF29824018416891"
CRI+PP:12345678"
PAP+A:ONE:ADULT H:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::ONE:ADULT H"
PAP+IN:ONE:INFANT H:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M:701:::::ONE:INFANT H"
UNT+12+1"
UNZ+1+1"


# общение с СЭБ (смена статуса на CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 1) ЮТ 2982401841612 1 CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(last_edifact_ref 0) ЮТ 2982401841689 1 CK)


<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref 1) 2982401841612 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(last_edifact_ref 0) 2982401841689 1 CK)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+ONE+A:Y+xxxxxxxxxx:xxxxxxxxxx+ADULT+ONE:INFANT"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001:002+Y"
PSI++TKNE::29824018416121+TKNE::INF29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/ADULT+FOID::::::FOID PPZB400522509+INFT::::::INFT HK1 01JAN17 ONE/INFANT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/ADULT/M"
PAP+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::ONE:ADULT H"
PAP+IN:ONE:INFANT:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M::::::ONE:INFANT H"
UNT+11+1"
UNZ+1+ASTRA000660001"


# обновление
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+A:Y++ADULT+ONE:INFANT"
UAP+R+A:::760501:::USA++P:99999999999:USA:::$(yymmdd +6y):M::::::ONE:ADULT:ABRAMOVICH"
UAP+R+IN:::170202:::RUS++P:88888888888:USA:::$(yymmdd +7y):M::::::ONE:INFANT:ADULTOVICH"
UNT+10+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


# пересадка
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+A:Y++ADULT+ONE:INFANT"
USD++4А"
UNT+10+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


# печать
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+A:Y++ADULT+ONE:INFANT"
UNT+10+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+B+O"
FSD+0950"
PPD+ONE+A:Y+xxxxxxxxxx:xxxxxxxxxx+ADULT+ONE:INFANT"
PRD+Y"
PFD+004A+N:Y:3:::::Y:N+001:002+Y"
PSI++TKNE::29824018416121+TKNE::INF29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/ADULT+FOID::::::FOID PPZB400522509+INFT::::::INFT HK1 01JAN17 ONE/INFANT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/ADULT/M"
PAP+A:ONE:ADULT:760501:::USA++P:99999999999:USA:::$(yymmdd +6y):M::::::ONE:ADULT:ABRAMOVICH"
PAP+IN:ONE:INFANT:170202:::RUS++P:88888888888:USA:::$(yymmdd +7y):M::::::ONE:INFANT:ADULTOVICH"
UNT+11+1"
UNZ+1+ASTRA000660001"


# отмена регистрации пакса с младенцем
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+A:Y++ADULT+ONE:INFANT"
UNT+5+1"
UNZ+1+ASTRA000680001"


# общение с СЭБ (откат статуса)
$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841612 1 I)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841689 1 I)


<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841612 1 I)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841689 1 I)



>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"


%%
#########################################################################################
# №20

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   REPIN PETR 2982401841612 1)


$(deny_ets_interactive ЮТ 103 ДМД)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++PETR"
PRD+Y"
PSD+N"
PBD+0"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+12+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/REPIN/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/REPIN/PETR/M"
PAP+A:REPIN:PETR:850724:::TJK++P:400522510:TJK:::250205:M::::::REPIN:PETR"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+15+1"
UNZ+1+ASTRA000660001"


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++PETR"
UBD+R:1:13+R:1:5+R:NP+R:U6:241:1:LED:262"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"

<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
UBD+R:1:12+R:2:8+R:NP+R:U6:260:1:LED:262"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++PETR"
UBD+R:3:15++R:NP+R:U6:245:2:LED:262+R:U6:248:1:LED:262"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++PETR"
UBD+R:0:0++R:NP"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"

<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
UBD+R:1:12++R:NP+R:U6:277:1:LED:262"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"

<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++PETR"
UBD+R:0:0+R:0:0+R:NP"
PPD+REPIN+A:N++IVAN"
UBD+R:0:0+R:0:0+R:NP"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №21

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса с однофамильцами
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   REPIN IVAN 2982401841612 1)


$(deny_ets_interactive ЮТ 103 ДМД)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+9+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:6:TOO MANY PASSENGERS WITH SAME SURNAME"
UNT+5+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PSI++TKNE::29824018416891"
UNT+9+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"

$(set point_dep $(last_point_id_spp))
$(set repin1_id $(get_pax_id $(get point_dep) REPIN IVAN))


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PSI++TKNE::29824018416121"
UNT+9+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522510:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
USD++4А"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+X"
ERD+1:6:TOO MANY PASSENGERS WITH SAME SURNAME"
UNT+5+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N+$(lpad $(get repin1_id) 10 "0")+IVAN"
USD++4А"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N+$(lpad $(get repin1_id) 10 "0")+IVAN"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N+$(lpad $(get repin1_id) 10 "0")+IVAN"
USD++5А"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+X"
ERD+1:194:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №22

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
PAP+A:REPIN:IVAN:880624:::TJK++PT:4005123456:TJK:::250205:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:880624:::TJK++P:4005123456:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №23

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQSMF:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRSMF:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+S+X"
ERD+1:5:INVALID FLIGHT/DATE"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# 24

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M:N++IVAN++0013949607"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+0"
PSI++TKNE::29824018416891"
CRI+PP:12345678"
PAP+A:REPIN:IVAN H:080101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::REPIN:IVAN H"
ADD++700:::::USA"
UNT+11+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:080101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::REPIN:IVAN H"
ADD++700:::::USA"
UNT+11+1"
UNZ+1+ASTRA000660001"


# отмена регистрации в Астру
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+M++IVAN++S71027"
UNT+5+1"
UNZ+1+ASTRA000680001"

>> lines=auto
RAD+X+P"


# ADD без PAP
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M:N++IVAN++0013949607"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+0"
PSI++TKNE::29824018416891"
CRI+PP:12345678"
PAP"
ADD++700:::::USA"
UNT+11+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
ADD++700:::::USA"
UNT+11+1"
UNZ+1+ASTRA000660001"



<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
UAP+R+:::760501:::RUS++P:99999999999:USA:::$(yymmdd +7y):M::::::REPIN:IVAN:ABRAMOVICH"
ADD+R+700:::::RUS:10001+701:::::USA"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVAN"
UAP"
ADD+C+701"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# 25

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_1INFT_1SEG ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   ONE ADULT 2982401841612 1
                   ONE INFANT 2982401841689 1)

$(deny_ets_interactive ЮТ 103 ДМД)


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+ONE+M:Y++ADULT+ONE:INFANT+0013949613:0013949614"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+0"
PSI++TKNE::29824018416121+TKNE::INF29824018416891"
CRI+PP:12345678"
PAP+A:ONE:ADULT H:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::ONE:ADULT H"
ADD++700:::::USA"
PAP+IN:ONE:INFANT H:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M:701:::::ONE:INFANT H"
ADD++701:::::RUS"
UNT+12+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+ONE+A:Y+xxxxxxxxxx:xxxxxxxxxx+ADULT+ONE:INFANT"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001:002+Y"
PSI++TKNE::29824018416121+TKNE::INF29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/ADULT+FOID::::::FOID PPZB400522509+INFT::::::INFT HK1 01JAN17 ONE/INFANT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/ADULT/M"
PAP+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::ONE:ADULT H"
ADD++700:::::USA"
PAP+IN:ONE:INFANT:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M::::::ONE:INFANT H"
ADD++701:::::RUS"
UNT+13+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+A:N++ADULT"
UAP"
ADD+C+700"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT+ONE:INFANT"
UAP++IN"
ADD+C+701"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT"
UAP"
ADD++701:::::RUS"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT"
UAP++IN"
ADD++701:::::USA"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT"
UAP+A+IN:ONE:INFANT:180111:::BY++P:123456733:BY:::$(yymmdd +7y):M:702"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+B+O"
FSD+0950"
PPD+ONE+A:Y+xxxxxxxxxx:xxxxxxxxxx+ADULT+ONE:INFANT"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001:002+Y"
PSI++TKNE::29824018416121+TKNE::INF29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/ADULT+FOID::::::FOID PPZB400522509+INFT::::::INFT HK1 01JAN17 ONE/INFANT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/ADULT/M"
PAP+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::ONE:ADULT H"
ADD++701:::::RUS"
PAP+IN:ONE:INFANT:180111:::BLR++P:123456733:BLR:::$(yymmdd +7y):M::::::ONE:INFANT"
ADD++701:::::USA"
UNT+13+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT"
UNT+5+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# 26

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_1INFT_1SEG ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   ONE ADULT 2982401841612 1
                   ONE INFANT 2982401841689 1)

$(deny_ets_interactive ЮТ 103 ДМД)

<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+ONE+M:Y++ADULT+ONE:INFANT+0013949613:0013949614"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+1:13+1:5+NP"
PSI++TKNE::29824018416121+TKNE::INF29824018416891"
CRI+PP:12345678"
PAP+A:ONE:ADULT H:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::ONE:ADULT H"
ADD++701:::::RUS"
PAP+IN:ONE:INFANT H:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M:701:::::ONE:INFANT H+VI:525747:USA"
ADD++701:::::RUS"
UNT+13+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102"
UNT+5+1"
UNZ+1+ASTRA000660001"



<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+ONE+M:Y++ADULT+ONE:INFANT+0013949613:0013949614"
PRD+Y+OK++KKKNKZ"
PSD+N"
PBD+1:13+1:5+NP+S7:241:1:LED:421"
PSI++TKNE::29824018416121+TKNE::INF29824018416891"
CRI+PP:12345678"
PAP+A:ONE:ADULT H:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M:701:::::ONE:ADULT H"
ADD++701:::::RUS"
PAP+IN:ONE:INFANT H:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M:701:::::ONE:INFANT H+VI:525747:USA"
ADD++701:::::RUS"
UNT+13+1"
UNZ+1+1"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+ONE+A:Y+xxxxxxxxxx:xxxxxxxxxx+ADULT+ONE:INFANT"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001:002+Y"
PBD+1:13+1:5+NP+S7:241:1:LED:421"
PSI++TKNE::29824018416121+TKNE::INF29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/ONE/ADULT+FOID::::::FOID PPZB400522509+INFT::::::INFT HK1 01JAN17 ONE/INFANT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/ONE/ADULT/M"
PAP+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +2y):M::::::ONE:ADULT H"
ADD++701:::::RUS"
PAP+IN:ONE:INFANT:170101:::RUS++P:1234566:RUS:::$(yymmdd +3y):M::::::ONE:INFANT H+V:525747:USA"
ADD++701:::::RUS"
UNT+14+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT+ONE:INFANT"
UAP"
ADD+C+701"
UAP+C+IN:ONE:INFANT:170101:::RUS++V:525747:USA"
ADD+C+701"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT+ONE:INFANT"
UAP+C+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +6y):::::::ONE:ADULT H"
UAP+C+IN:ONE:INFANT:170101:::RUS++P:1234566:RUS:::$(yymmdd +7y):::::::ONE:INFANT H"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+U6:SVX:RU"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT+ONE:INFANT"
UAP+A+A:ONE:ADULT:500101:::RUS++P:1234566:RUS:::$(yymmdd +6y):::::::ONE:ADULT H+VI:777888:USA"
ADD+A+701:::::RUS"
UAP+A+IN:ONE:INFANT:170101:::RUS++P:1234566:RUS:::$(yymmdd +7y):::::::ONE:INFANT H+VI:888777:RUS"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+ONE+M:Y++ADULT+ONE:INFANT"
UBD+R:3:15++R:NP+R:S7:245:2:LED:421+R:S7:248:1:LED:421"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №27

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN {IVAN MR} 2982401841689 1
                   PETROV PETR 2982401841612 1)

$(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре на регистрацию одного пакса
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVANMR"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN MR"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN MR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN MR/M"
PAP+A:REPIN:IVAN MR:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN MR"
UNT+10+1"
UNZ+1+ASTRA000660001"


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A:N++IVANMR"
USI++A:OTHS::::::OTHS FREE TEXT"
UAP+R+:::760501:::RUS++P:99999999999:USA:::491231:M::::::REPIN:IVAN:ABRAMOVICH"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №28

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

# подготовка рейса
$(PREPARE_FLIGHT_2PAXES_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ
                   REPIN IVAN 2982401841689 1
                   PETROV PETR 2982401841612 1)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+2:13++NP+S7:241:2:LED:421"
PAP+A:REPIN:IVAN:850307:::JP+:::DECLINED+P:TL0046022:JP:::231007:F:702"
PPD+PETROV+M++PETR"
PRD+Y"
PSD+N"
PBD+1:7+1:5+NP+S7:243:1:LED:421"
PAP+A:PETROV:PETR:870408:::JP+:::DECLINED+P:TL0046023:JP:::000101:F:702"
UNT+12+1"
UNZ+1+ASTRA000660001"

$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

# запросы в СЭБ
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841612 1 CK)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841689 1 CK)


<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841612 1 CK)


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PBD+2:13++NP+S7:241:2:LED:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850307:::JPN++P:TL0046022:JPN:::231007:F::::::REPIN:IVAN"
PPD+PETROV+A:N+xxxxxxxxxx+PETR"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+002+Y"
PBD+1:7+1:5+NP+S7:243:1:LED:421"
PSI++TKNE::29824018416121+DOCS::::::DOCS HK1/P/TJK/400522510/TJK/24JUL85/M/05FEB25/PETROV/PETR+FOID::::::FOID PPZB400522510+PSPT::::::PSPT HK1 ZB400522510/TJK/24JUL85/PETROV/PETR/M"
PAP+A:PETROV:PETR:870408:::JPN++P:TL0046023:JPN:::000101:F::::::PETROV:PETR"
UNT+17+1"
UNZ+1+ASTRA000660001"


# смена мест обоим пассажирам
<<
UNB+SIRE:1+DCS1+DCS2+180727:0441+FFCE00069A0001+++O"
UNH+1+DCQCKU:03:1:IA+30389AC1000D"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED+T"
PPD+REPIN+A:N++IVAN"
PRD+K+OK++HLMWCF"
USD++001A"
PPD+PETROV+A:N++PETR"
PRD+K+OK++HLMWCF"
USD++001B"
UNT+10+86"
UNZ+1+FFCE00069A0001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+FFCE00069A0001+++T"
UNH+1+DCRCKA:03:1:IA+30389AC1000D"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+FFCE00069A0001"


%%
#########################################################################################
# №29

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS1 DCS2)

$(settcl SIRENA_HOST localhost)
$(settcl SIRENA_PORT 8008)

# подготовка рейса
$(PREPARE_FLIGHT_1PAX_2SEGS_WITH_REMARKS ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

$(sql "update TRIP_SETS set PIECE_CONCEPT=1")


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+REPIN+A:N+xxxxxxxxxx+IVAN"
PRD+Y"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M"
PAP+A:REPIN:IVAN:850724:::TJK++P:400522509:TJK:::250205:M::::::REPIN:IVAN"
UNT+10+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+M++IVAN"
UBD+R:1:13+R:1:5+R:NP+R:U6:241:1:LED:262"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №30

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS_S7 DCS_UT)
$(init_dcs СУ DCS_SU DCS_UT)

$(PREPARE_SEASON_SCD ЮТ ДМД ПЛК 101)
$(make_spp)

<<
$(PNL_2PAXES_3SEGS_WITH_REMARKS ЮТ ДМД ПЛК 101
                                СУ ПЛК СОЧ 202
                                У6 СОЧ РОЩ 303
                                PUTIN VLADIMIR   2982401841689 1 K Y 0840Z6 09T1B3
                                MEDVEDEV DMITRII 2982401841735 1 Y M 0850Z7 09T1C4)

$(set ediref1 $(last_edifact_ref 1))
$(set ediref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref1) ЮТ 2982401841689)
>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref0) ЮТ 2982401841735)

<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref1) UT 2982401841689 I PUTIN VLADIMIR $(ddmmyy) DME LED 101)
<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref0) UT 2982401841735 I MEDVEDEV DMITRII $(ddmmyy) DME LED 101)

$(auto_set_craft $(get_dep_point_id ДМД ЮТ 101 $(yymmdd +0)))


# $(deny_ets_interactive ЮТ 101 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:EKN"
DMC++++9"
FDQ+UT+101+$(yymmdd)+DME+LED++S7+550+$(yymmdd)0530+$(yymmdd)0940+EKN+DME"
PPD+PUTIN+M++VLADIMIR"
PRD+Y"
PSD+N"
PBD+0"
PPD+MEDVEDEV+M++DMITRII"
PRD+K"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841689 1 CK xxxxxx ДМД ПЛК 101 Y)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 CK xxxxxx ДМД ПЛК 101 K)

<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841735 1 CK)


>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKI:94:1:IA+$(last_edifact_ref)"
LOR+UT"
DMC++++8"
CHD+S7:EKN++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)+LED+AER++UT+101+$(yymmdd)++DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
PRD+K"
PBD+0"
PPD+MEDVEDEV+A:N++DMITRII"
PRD+Y"
PBD+0"
UNT+12+1"
UNZ+1+$(last_edifact_ref)0001"


# эмуляция таймаута ответа DCS
$(pg_sql {update EDISESSION_TIMEOUTS set time_out = current_timestamp - interval '1 hour'})
$(run_daemon edi_timeout)


$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))


# откатываем статусы
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841689 1 I xxxxxx ДМД ПЛК 101 Y)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 I xxxxxx ДМД ПЛК 101 K)


# отвечаем
>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+101+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:196:TIMEOUT OCCURED ON HOST 3"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №31

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS_S7 DCS_UT)
$(init_dcs СУ DCS_SU DCS_UT)

$(PREPARE_SEASON_SCD ЮТ ДМД ПЛК 101)
$(make_spp)

<<
$(PNL_2PAXES_3SEGS_WITH_REMARKS ЮТ ДМД ПЛК 101
                                СУ ПЛК СОЧ 202
                                У6 СОЧ РОЩ 303
                                PUTIN VLADIMIR   2982401841689 1 K Y 0840Z6 09T1B3
                                MEDVEDEV DMITRII 2982401841735 1 Y M 0850Z7 09T1C4)

$(set ediref1 $(last_edifact_ref 1))
$(set ediref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref1) ЮТ 2982401841689)
>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref0) ЮТ 2982401841735)

<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref1) UT 2982401841689 I PUTIN VLADIMIR $(ddmmyy) DME LED 101)
<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref0) UT 2982401841735 I MEDVEDEV DMITRII $(ddmmyy) DME LED 101)

$(auto_set_craft $(get_dep_point_id ДМД ЮТ 101 $(yymmdd +0)))


# $(deny_ets_interactive ЮТ 101 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7"
DMC++++7"
CHD+U6:EKN++++++++H::S7+H::U6"
FDQ+UT+101+$(yymmdd)+DME+LED++S7+550+$(yymmdd)0530+$(yymmdd)0940+EKN+DME"
PPD+PUTIN+M++VLADIMIR"
PRD+Y"
PSD+N"
PBD+0"
PPD+MEDVEDEV+M++DMITRII"
PRD+K"
PSD+N"
PBD+0"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841689 1 CK xxxxxx ДМД ПЛК 101 Y)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 CK xxxxxx ДМД ПЛК 101 K)

<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841735 1 CK)


>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKI:94:1:IA+$(last_edifact_ref)"
LOR+UT"
DMC++++6"
CHD+U6:EKN++++++++H::UT+H::S7+H::U6"
FDQ+SU+202+$(yymmdd)+LED+AER++UT+101+$(yymmdd)++DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
PRD+K"
PBD+0"
PPD+MEDVEDEV+A:N++DMITRII"
PRD+Y"
PBD+0"
UNT+12+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+I+X"
ERD+1:102"
UNT+5+1"
UNZ+1+$(last_edifact_ref)0001"


$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))


# откатываем статусы
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841689 1 I xxxxxx ДМД ПЛК 101 Y)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 I xxxxxx ДМД ПЛК 101 K)


# отвечаем
>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+101+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"



%%
#########################################################################################
# №32

$(init_term 201509-0173355)

$(init_eds ЮТ UTET UTDC)
$(init_dcs С7 DCS_S7 DCS_UT)
$(init_dcs СУ DCS_SU DCS_UT)

$(PREPARE_SEASON_SCD ЮТ ДМД ПЛК 101)
$(make_spp)

<<
$(PNL_2PAXES_3SEGS_WITH_REMARKS ЮТ ДМД ПЛК 101
                                СУ ПЛК СОЧ 202
                                У6 СОЧ РОЩ 303
                                PUTIN VLADIMIR   2982401841689 1 K Y 0840Z6 09T1B3
                                MEDVEDEV DMITRII 2982401841735 1 Y M 0850Z7 09T1C4)

$(set ediref1 $(last_edifact_ref 1))
$(set ediref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref1) ЮТ 2982401841689)
>>
$(TKCREQ_ET_DISP UTDC UTET $(get ediref0) ЮТ 2982401841735)

<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref1) UT 2982401841689 I PUTIN VLADIMIR $(ddmmyy) DME LED 101)
<<
$(TKCRES_ET_DISP_1CPN UTET UTDC $(get ediref0) UT 2982401841735 I MEDVEDEV DMITRII $(ddmmyy) DME LED 101)

$(auto_set_craft $(get_dep_point_id ДМД ЮТ 101 $(yymmdd +0)))


# $(deny_ets_interactive ЮТ 101 ДМД)


# запрос на регистрацию к Астре
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:03:1:IA+ASTRA00066"
LOR+S7:EKN"
FDQ+UT+101+$(yymmdd)+DME+LED++S7+550+$(yymmdd)0530+$(yymmdd)0940+EKN+DME"
PPD+PUTIN+M++VLADIMIR"
PRD+Y"
PSD+N"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PPD+MEDVEDEV+M++DMITRII"
PRD+K"
PSD+N"
PBD+1:10++NP+S7:210:1:TJM:421"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(set edi_ref1 $(last_edifact_ref 1))
$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref1) ЮТ 2982401841689 1 CK xxxxxx ДМД ПЛК 101 Y)
>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 CK xxxxxx ДМД ПЛК 101 K)

<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref1) 2982401841689 1 CK)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841735 1 CK)


>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKI:94:1:IA+$(last_edifact_ref)"
LOR+UT"
DMC++++8"
CHD+S7:EKN++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)+LED+AER++UT+101+$(yymmdd)++DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
PRD+K"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PPD+MEDVEDEV+A:N++DMITRII"
PRD+Y"
PBD+1:10++NP+S7:210:1:TJM:421"
UNT+12+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++O"
UNH+1+DCRCKA:94:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)1200+LED+AER++T"
RAD+I+O"
FSD+1535++GATE1"
PPD+PUTIN+A:N+0013929620+VLADIMIR"
PFD+005A"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/PUTIN/VLADIMIR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/PUTIN/VLADIMIR/M"
PAP+A:PUTIN:VLADIMIR:850724:::TJK++P:400522509:TJK:::250205:M::::::PUTIN:VLADIMIR"
PPD+MEDVEDEV+A:N+0013929621+DMITRII"
PFD+005B"
PBD+1:10++NP+S7:210:1:TJM:421"
PSI++TKNE::29824018417351+DOCS::::::DOCS HK1/P/TJK/400522512/TJK/24JUL86/M/05FEB22/MEDVEDEV/DMITRII+FOID::::::FOID PPZB400522512+PSPT::::::PSPT HK1 ZB400522512/TJK/24JUL86/MEDVEDEV/DMITRII/M"
PAP+A:MEDVEDEV:DMITRII:860724:::TJK++P:400522512:TJK:::220205:M::::::MEDVEDEV:DMITRII"
FDR+U6+303+$(yymmdd)1500+AER+TJM++T"
RAD+I+O"
FSD+2035++GATE1"
PPD+PUTIN+A:N+223929624+VLADIMIR"
PFD+005A"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/PUTIN/VLADIMIR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/PUTIN/VLADIMIR/M"
PAP+A:PUTIN:VLADIMIR:850724:::TJK++P:400522509:TJK:::250205:M::::::PUTIN:VLADIMIR"
PPD+MEDVEDEV+A:N+223929625+DMITRII"
PFD+005B"
PBD+1:10++NP+S7:210:1:TJM:421"
PSI++TKNE::29824018417351+DOCS::::::DOCS HK1/P/TJK/400522512/TJK/24JUL86/M/05FEB22/MEDVEDEV/DMITRII+FOID::::::FOID PPZB400522512+PSPT::::::PSPT HK1 ZB400522512/TJK/24JUL86/MEDVEDEV/DMITRII/M"
PAP+A:MEDVEDEV:DMITRII:860724:::TJK++P:400522512:TJK:::220205:M::::::MEDVEDEV:DMITRII"
UNT+14+1"
UNZ+1+$(last_edifact_ref)0001"


# ответ
>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+101+$(yymmdd)1015+DME+LED++T"
RAD+I+O"
FSD+0950"
PPD+PUTIN+A:N+xxxxxxxxxx+VLADIMIR"
PRD+Y"
PFD+xxxx+N:Y:3:::::Y:N+001+Y"
PBD+1:13+1:5+NP+S7:200:1:xxx:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/PUTIN/VLADIMIR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/PUTIN/VLADIMIR/M"
PAP+A:PUTIN:VLADIMIR:850724:::TJK++P:400522509:TJK:::250205:M::::::PUTIN:VLADIMIR"
PPD+MEDVEDEV+A:N+xxxxxxxxxx+DMITRII"
PRD+K"
PFD+xxxx+N:Y:3:::::Y:N+002+Y"
PBD+1:10++NP+S7:210:1:xxx:421"
PSI++TKNE::29824018417351+DOCS::::::DOCS HK1/P/TJK/400522512/TJK/24JUL86/M/05FEB22/MEDVEDEV/DMITRII+FOID::::::FOID PPZB400522512+PSPT::::::PSPT HK1 ZB400522512/TJK/24JUL86/MEDVEDEV/DMITRII/M"
PAP+A:MEDVEDEV:DMITRII:860724:::TJK++P:400522512:TJK:::220205:M::::::MEDVEDEV:DMITRII"
FDR+SU+202+$(yymmdd)1200+LED+AER++T"
RAD+I+O"
FSD+1535++GATE1"
PPD+PUTIN+A:N+0013929620+VLADIMIR"
PFD+005A+:::::::Y+Y"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/PUTIN/VLADIMIR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/PUTIN/VLADIMIR/M"
PAP+A:PUTIN:VLADIMIR:850724:::TJK++P:400522509:TJK:::250205:M::::::PUTIN:VLADIMIR"
PPD+MEDVEDEV+A:N+0013929621+DMITRII"
PFD+005B+:::::::Y+Y"
PBD+1:10++NP+S7:210:1:TJM:421"
PSI++TKNE::29824018417351+DOCS::::::DOCS HK1/P/TJK/400522512/TJK/24JUL86/M/05FEB22/MEDVEDEV/DMITRII+FOID::::::FOID PPZB400522512+PSPT::::::PSPT HK1 ZB400522512/TJK/24JUL86/MEDVEDEV/DMITRII/M"
PAP+A:MEDVEDEV:DMITRII:860724:::TJK++P:400522512:TJK:::220205:M::::::MEDVEDEV:DMITRII"
FDR+U6+303+$(yymmdd)1500+AER+TJM++T"
RAD+I+O"
FSD+2035++GATE1"
PPD+PUTIN+A:N+223929624+VLADIMIR"
PFD+005A+:::::::Y+Y"
PBD+1:13+1:5+NP+S7:200:1:TJM:421"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/PUTIN/VLADIMIR+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/PUTIN/VLADIMIR/M"
PAP+A:PUTIN:VLADIMIR:850724:::TJK++P:400522509:TJK:::250205:M::::::PUTIN:VLADIMIR"
PPD+MEDVEDEV+A:N+223929625+DMITRII"
PFD+005B+:::::::Y+Y"
PBD+1:10++NP+S7:210:1:TJM:421"
PSI++TKNE::29824018417351+DOCS::::::DOCS HK1/P/TJK/400522512/TJK/24JUL86/M/05FEB22/MEDVEDEV/DMITRII+FOID::::::FOID PPZB400522512+PSPT::::::PSPT HK1 ZB400522512/TJK/24JUL86/MEDVEDEV/DMITRII/M"
PAP+A:MEDVEDEV:DMITRII:860724:::TJK++P:400522512:TJK:::220205:M::::::MEDVEDEV:DMITRII"
UNT+43+1"
UNZ+1+ASTRA000660001"


# запрос на обновление паспортных данных
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000610001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00061"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+MEDVEDEV+A:N++DMITRII"
UAP+R+A:::760501:::RUS++P:99999999999:USA:::491231:M::::::MEDVEDEV:DMITRII:ABRAMOVICH"
UNT+6+1"
UNZ+1+ASTRA000610001"

>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKU:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)1200+LED+AER"
PPD+MEDVEDEV+A:N+xxxxxxxxxx+DMITRII"
UAP+R+A:MEDVEDEV:DMITRII:760501:::RUS++P:99999999999:USA:::491231:M::::::MEDVEDEV:DMITRII:ABRAMOVICH"
UNT+7+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+U+P"
UNT+4+1"
UNZ+1+$(last_edifact_ref)0001"


>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000610001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00061"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000610001"


# запрос на смену места на "нашем" сегменте
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000610001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00061"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED+T"
PPD+MEDVEDEV+A:N++DMITRII"
USD++004A"
UNT+6+1"
UNZ+1+ASTRA000610001"

>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000610001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00061"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000610001"


# запрос на смену места на "чужом" сегменте
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000610001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00061"
LOR+S7:SVO"
CHD++SU+202+$(yymmdd)+LED+AER+T"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
USD++004B"
UNT+6+1"
UNZ+1+ASTRA000610001"


>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKU:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO+SU+202+$(yymmdd)+LED+AER+T++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)1200+LED+AER"
PPD+PUTIN+A:N+xxxxxxxxxx+VLADIMIR"
USD++004B"
UNT+7+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+U+P"
CHD+++++++++H::SU"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000610001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00061"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000610001"


# запрос на изменение багажа
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
UBD+R:2:25++R:NP+R:S7:220:2:TJM:421"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKU:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)1200+LED+AER"
PPD+PUTIN+A:N+xxxxxxxxxx+VLADIMIR"
UBD+R:2:25++R:NP+R:S7:220:2:TJM:421"
UNT+7+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+U+P"
CHD+++++++++H::SU"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


# ещё запрос на изменение багажа
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:03:1:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
UBD+R:1:4++R:NP+R:S7:222:1:TJM:421"
PPD+MEDVEDEV+A:N++DMITRII"
UBD+R:0+R:1:5+R:NP"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKU:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)1200+LED+AER"
PPD+PUTIN+A:N+0013929620+VLADIMIR"
UBD+R:1:4++R:NP+R:S7:222:1:TJM:421"
PPD+MEDVEDEV+A:N+0013929621+DMITRII"
UBD+R:0+R:1:5+R:NP"
UNT+9+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+U+P"
CHD+++++++++H::SU"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00066"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+U+P"
UNT+4+1"
UNZ+1+ASTRA000660001"


# запрос на отмену регистрации к Астре одного пассажира
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+MEDVEDEV+A:N++DMITRII"
UNT+6+1"
UNZ+1+ASTRA000680001"


$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841735 1 I xxxxxx ДМД ПЛК 101 K)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841735 1 I)


# идём за отменой на следующем сегменте
>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKX:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)+LED+AER"
PPD+MEDVEDEV+A:N+0013929621+DMITRII"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+X+P"
UNT+4+1"
UNZ+1+$(last_edifact_ref)0001"


# формируем окончательный ответ для S7
>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00068"
FDR+UT+101+$(yymmdd)1015+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"


# запрос на отмену регистрации к Астре другого пассажира
<<
UNB+SIRE:1+DCS_S7+DCS_UT+150217:0747+ASTRA000690001+++O"
UNH+1+DCQCKX:03:1:IA+ASTRA00069"
LOR+S7:SVO"
FDQ+UT+101+$(yymmdd)+DME+LED"
PPD+PUTIN+A:N++VLADIMIR"
UNT+6+1"
UNZ+1+ASTRA000690001"


$(set edi_ref0 $(last_edifact_ref 0))

>>
$(TKCREQ_ET_COS UTDC UTET $(get edi_ref0) ЮТ 2982401841689 1 I xxxxxx ДМД ПЛК 101 Y)
<<
$(TKCRES_ET_COS UTET UTDC $(get edi_ref0) 2982401841689 1 I)

# идём за отменой на следующем сегменте
>>
UNB+SIRE:1+DCS_UT+DCS_SU+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+DCQCKX:94:1:IA+$(last_edifact_ref)"
LOR+UT"
CHD+S7:SVO++++++++H::UT+H::S7"
FDQ+SU+202+$(yymmdd)+LED+AER"
PPD+PUTIN+A:N+0013929620+VLADIMIR"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

<<
UNB+SIRE:1+DCS_SU+DCS_UT+150217:0747+$(last_edifact_ref)0001+++T"
UNH+1+DCRCKA:03:1:IA+$(last_edifact_ref)"
FDR+SU+202+$(yymmdd)+LED+AER"
RAD+X+P"
UNT+4+1"
UNZ+1+$(last_edifact_ref)0001"


>>
UNB+SIRE:1+DCS_UT+DCS_S7+xxxxxx:xxxx+ASTRA000690001+++T"
UNH+1+DCRCKA:03:1:IA+ASTRA00069"
FDR+UT+101+$(yymmdd)+DME+LED"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000690001"
