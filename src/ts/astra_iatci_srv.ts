include(ts/macro.ts)

# meta: suite iatci

$(defmacro ETS_COS_EXCHANGE
    tickno
    cpnno
    status
    pult=МОВРОМ
{

>>
UNB+SIRE:1+UTDC+UTET+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+TKCREQ:96:2:IA+$(last_edifact_ref)"
MSG+:142"
ORG+ЮТ:МОВ++++Y+::RU+$(pult)"
EQN+1:TD"
TKT+$(tickno):T"
CPN+$(cpnno):$(status)"
TVL+$(ddmmyy)+ДМД+ПЛК+ЮТ+103: ++1"
UNT+8+1"
UNZ+1+$(last_edifact_ref)0001"

# ответ от СЭБ
<<
UNB+SIRE:1+UTET+UTDC+151027:1527+$(last_edifact_ref)0001+++T"
UNH+1+TKCRES:96:2:IA+$(last_edifact_ref)"
MSG+:142+3"
EQN+1:TD"
TKT+$(tickno):T::3"
CPN+$(cpnno):$(status)::E"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"

}) #end-of-macro

#########################################################################################
# №1
$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №2

$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN++S71027"
PRD+Y"
PSD++1A"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"


# пошёл запрос в СЭБ на смену статуса из астры
>>
UNB+SIRE:1+UTDC+UTET+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+TKCREQ:96:2:IA+$(last_edifact_ref)"
MSG+:142"
ORG+ЮТ:МОВ++++Y+::RU+SYSTEM"
EQN+1:TD"
TKT+2982401841689:T"
CPN+1:CK"
TVL+$(ddmmyy)+ДМД+ПЛК+ЮТ+103: ++1"
UNT+8+1"
UNZ+1+$(last_edifact_ref)0001"


# TODO здесь нужно сэмулировать таймаут ответа СЭБ
$(sql {update EDISESSION_TIMEOUTS set time_out = sysdate - 1})
$(run_daemon edi_timeout)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+X"
ERD+1:102:UNABLE TO PROCESS - SYSTEM ERROR"
UNT+5+1"
UNZ+1+ASTRA000660001"



# ещё запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000670001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00067"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN++S71027"
PRD+Y"
PSD++1A"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000670001"



# пошёл запрос в СЭБ на смену статуса из астры
>>
UNB+SIRE:1+UTDC+UTET+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+TKCREQ:96:2:IA+$(last_edifact_ref)"
MSG+:142"
ORG+ЮТ:МОВ++++Y+::RU+SYSTEM"
EQN+1:TD"
TKT+2982401841689:T"
CPN+1:CK"
TVL+$(ddmmyy)+ДМД+ПЛК+ЮТ+103: ++1"
UNT+8+1"
UNZ+1+$(last_edifact_ref)0001"

# ответ от СЭБ
<<
UNB+SIRE:1+UTET+UTDC+151027:1527+$(last_edifact_ref)0001+++T"
UNH+1+TKCRES:96:2:IA+$(last_edifact_ref)"
MSG+:142+3"
EQN+1:TD"
TKT+2982401841689:T::3"
CPN+1:CK::E"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000670001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00067"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000670001"



# отмена регистрации в Астру
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000680001+++O"
UNH+1+DCQCKX:96:2:IA+ASTRA00068"
LOR+S7:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК++T"
PPD+REPIN+M++IVAN++S71027"
UNT+5+1"
UNZ+1+ASTRA000680001"


# пошли в СЭБ откатывать статус купона
>>
UNB+SIRE:1+UTDC+UTET+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+TKCREQ:96:2:IA+$(last_edifact_ref)"
MSG+:142"
ORG+ЮТ:МОВ++++Y+::RU+SYSTEM"
EQN+1:TD"
TKT+2982401841689:T"
CPN+1:I"
TVL+$(ddmmyy)+ДМД+ПЛК+ЮТ+103: ++1"
UNT+8+1"
UNZ+1+$(last_edifact_ref)0001"

# ответ от СЭБ
<<
UNB+SIRE:1+UTET+UTDC+151027:1527+$(last_edifact_ref)0001+++T"
UNH+1+TKCRES:96:2:IA+$(last_edifact_ref)"
MSG+:142+3"
EQN+1:TD"
TKT+2982401841689:T::3"
CPN+1:I::E"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"


# ответ на отмену из Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000680001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00068"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+P"
UNT+4+1"
UNZ+1+ASTRA000680001"


# ещё одна отмена регистрации в Астру
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000690001+++O"
UNH+1+DCQCKX:96:2:IA+ASTRA00069"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++T"
PPD+REPIN+M++IVAN++S71027"
UNT+5+1"
UNZ+1+ASTRA000690001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000690001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00069"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+X+X"
ERD+1:193:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000690001"


%%
#########################################################################################
# №3

$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# PLF до регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000700001+++O"
UNH+1+DCQPLF:96:2:IA+ASTRA00070"
LOR+UT:SVO"
FDQ+ЮТ+103+$(yymmdd)+ДМД+ПЛК++T"
SPD+REPIN:IVAN::1"
UNT+5+1"
UNZ+1+ASTRA000700001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000700001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00070"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+P+X"
ERD+1:193:PASSENGER SURNAME NOT CHECKED-IN"
UNT+5+1"
UNZ+1+ASTRA000700001"


# регистрация
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"


# PLF после регистрации
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000710001+++O"
UNH+1+DCQPLF:96:2:IA+ASTRA00071"
LOR+UT:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++T"
SPD+REPIN:IVAN::1"
UNT+5+1"
UNZ+1+ASTRA000710001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000710001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00071"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+P+O"
PPD+REPIN+A++IVAN"
PFD+1A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000710001"


%%
#########################################################################################
# №4
$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"


$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:96:2:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A++IVAN"
USI++A:OTHS::::::OTHS FREE TEXT"
UAP+R+:::010576:::RUS++P:99999999999:USA:::311249:M::::::REPIN:IVAN:ABRAMOVICH"
UNT+6+1"
UNZ+1+ASTRA000660001"


>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+O"
PPD+REPIN+A++IVAN"
PFD+1A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+OTHS::::::OTHS FREE TEXT+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::010576:::RUS++P:99999999999:USA:::311249:M::::::REPIN:IVAN:ABRAMOVICH"
UNT+8+1"
UNZ+1+ASTRA000660001"


# ещё запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:96:2:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A++IVAN"
USI++C:OTHS::::::OTHS FREE TEXT+A:FQTV::::::FQTV UT 12121212112"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+O"
PPD+REPIN+A++IVAN"
PFD+1A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+FQTV:::::: ЮТ 12121212112+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::010576:::RUS++P:99999999999:USA:::311249:M::::::REPIN:IVAN:ABRAMOVICH"
UNT+8+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №5
$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQSMF:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRSMF:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+S+O"
CBD+Э+1:13+++F++А+Б:A+В:A+Г"
UNT+5+1"
UNZ+1+ASTRA000660001"


%%
#########################################################################################
# №6
$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD+3A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"


<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKU:96:2:IA+ASTRA00066"
LOR+UT:DME"
FDQ+UT+103+$(yymmdd)+DME+LED"
PPD+REPIN+A++IVAN"
USD++4А"
UNT+6+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+U+O"
PPD+REPIN+A++IVAN"
PFD+4A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"

%%
#########################################################################################
# №7

$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"

$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)

# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD+3A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"



<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQBPR:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
UNT+5+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+B+O"
PPD+REPIN+A++IVAN"
PFD+3A+:Э+1"
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"



%%
#########################################################################################
# №8 левый запрос

$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UU+103+$(yymmdd)+LAL+LOL++OO+1027+$(yymmdd)0530+$(yymmdd)0940+AAA+BBB"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD++3А"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"

>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UU+103+$(yymmdd)+LAL+LOL++T"
RAD+I+X"
ERD+1:5:INVALID FLIGHT/DATE"
UNT+5+1"
UNZ+1+ASTRA000660001"

# считаем, что DCRCKA не дошёл до адресата, и эмулируем посылку им IFM
<<
IFMDCS2
.IFMDCS1
IFM
OO1027/$(ddmon +0 en) AAA PART1
-UU103/$(ddmon +0 en) LALLOL
DEL
1REPIN/IVAN
ENDIFM


%%
#########################################################################################
# №9 host to host


$(init)
$(init_jxt_pult МОВРОМ)
$(login)


# запрос к Астре
<< h2h=V.\VHLG.WA/E11ADCS1/I11HDCS2/P015ZK3\VGYA\$()
UNB+SIRE:1+U6+U6+161019:0436+1"
UNH+1+DCQSMF:03:1:IA+GUZ2TQPGKY0025"
LOR+U6:LCG"
FDQ+U6+537+$(yymmdd)+SAW+MAD"
SRP+Y"
UNT+5+1"
UNZ+1+1"

>>
UNB+SIRE:1+U6+U6+xxxxxx:xxxx+1"
UNH+1+DCRSMF:03:1:IA+GUZ2TQPGKY0025"
FDR+U6+537+$(yymmdd)+SAW+MAD++T"
RAD+S+X"
ERD+1:5:INVALID FLIGHT/DATE"
UNT+5+1"
UNZ+1+1"


%%
#########################################################################################
# №10
$(init)
$(init_jxt_pult МОВРОМ)
$(login)
$(init_eds ЮТ UTET UTDC)

# подготовка рейса
$(PREPARE_FLIGHT_2 ЮТ 103 ДМД ПЛК СУ 2278 ПЛК СОЧ REPIN IVAN)

# $(deny_ets_interactive ЮТ 103 ДМД)


# запрос к Астре
<<
UNB+SIRE:1+DCS1+DCS2+150217:0747+ASTRA000660001+++O"
UNH+1+DCQCKI:96:2:IA+ASTRA00066"
LOR+S7:SVO"
FDQ+UT+103+$(yymmdd)+DME+LED++S7+1027+$(yymmdd)0530+$(yymmdd)0940+AER+DME"
PPD+REPIN+M++IVAN"
PRD+Y"
PSD+N"
PBD+1:20"
UNT+8+1"
UNZ+1+ASTRA000660001"


$(ETS_COS_EXCHANGE 2982401841689 1 CK SYSTEM)


# ответ от Астры
>>
UNB+SIRE:1+DCS2+DCS1+xxxxxx:xxxx+ASTRA000660001+++T"
UNH+1+DCRCKA:96:2:IA+ASTRA00066"
FDR+UT+103+$(yymmdd)+DME+LED++T"
RAD+I+O"
PPD+REPIN+A++IVAN"
PFD...
PSI++TKNE::29824018416891+DOCS::::::DOCS HK1/P/TJK/400522509/TJK/24JUL85/M/05FEB25/REPIN/IVAN+FOID::::::FOID PPZB400522509+PSPT::::::PSPT HK1 ZB400522509/TJK/24JUL85/REPIN/IVAN/M+TKNE::::::TKNE HK1 2982401841689/1"
PAP+:::240785:::TJK++P:400522509:TJK:::050225:M::::::REPIN:IVAN"
UNT+8+1"
UNZ+1+ASTRA000660001"


# но ответ потерялся и нам прислали IFM DEL
<<
IFMDCS2
.IFMDCS1
IFM
S71027/$(ddmon +0 en) AER PART1
-UT103/$(ddmon +0 en) DMELED
DEL
1REPIN/IVAN
ENDIFM

>>
UNB+SIRE:1+UTDC+UTET+xxxxxx:xxxx+$(last_edifact_ref)0001+++O"
UNH+1+TKCREQ:96:2:IA+$(last_edifact_ref)"
MSG+:142"
ORG+ЮТ:МОВ++++Y+::RU+SYSTEM"
EQN+1:TD"
TKT+2982401841689:T"
CPN+1:I"
TVL+$(ddmmyy)+ДМД+ПЛК+ЮТ+103: ++1"
UNT+8+1"
UNZ+1+$(last_edifact_ref)0001"

# ответ от СЭБ
<<
UNB+SIRE:1+UTET+UTDC+151027:1527+$(last_edifact_ref)0001+++T"
UNH+1+TKCRES:96:2:IA+$(last_edifact_ref)"
MSG+:142+3"
EQN+1:TD"
TKT+2982401841689:T::3"
CPN+1:I::E"
UNT+6+1"
UNZ+1+$(last_edifact_ref)0001"
